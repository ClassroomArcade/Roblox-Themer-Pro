<!DOCTYPE html>
<html>
<head>
  <title>Theme Store | Roblox Studio Pro</title>
  <link rel="icon" type="image/x-icon" href="theme_studio_pro.ico">
  <style>
    :root { --primary: #0084ff; --dark: #0b0e11; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--dark); color: white; padding: 40px; margin: 0; overflow-x: hidden; transition: 0.5s ease; }
    
    /* The Background Preview Layer */
    #bgPreview {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: -2; opacity: 0.3; transition: 0.5s;
      background-size: cover; background-position: center;
    }

    h1 { font-size: 32px; margin-bottom: 5px; }
    p { color: #8899a6; margin-bottom: 30px; }

    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; position: relative; }
    
    .item { 
      background: rgba(21, 25, 30, 0.8); 
      padding: 20px; border-radius: 12px; text-align: center; 
      border: 1px solid #333; transition: 0.3s; 
      backdrop-filter: blur(5px);
    }
    .item:hover { transform: scale(1.05); border-color: var(--primary); box-shadow: 0 0 20px rgba(0, 132, 255, 0.2); }
    
    .preview-box { height: 100px; border-radius: 8px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); }
    
    .buy-btn { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; }
    .buy-btn:disabled { background: #28a745; cursor: default; opacity: 0.7; }
  </style>
</head>
<body>
  <div id="bgPreview"></div>

  <h1>Theme Store</h1>
  <p>Hover over a theme to preview it.</p>
  
  <div class="grid" id="storeGrid"></div>

  <script>
    const themes = [
      { id: 'cyberpunk', name: 'Cyberpunk Red', color: '#ff0055', bg: 'https://images.unsplash.com/photo-1605810230434-7631ac76ec81' },
      { id: 'modern_dark', name: 'Black Glass', color: '#1a1a1a', bg: 'https://images.unsplash.com/photo-1451187580459-43490279c0fa' },
      { id: 'ocean', name: 'Oceanic Blue', color: '#0077be', bg: 'https://images.unsplash.com/photo-1505118380757-91f5f45d8de4' }
    ];

    // Helper to render themes
    function renderStore(ownedList) {
      const grid = document.getElementById('storeGrid');
      const bgLayer = document.getElementById('bgPreview');
      grid.innerHTML = ''; // Clear previous content

      themes.forEach(t => {
        const isOwned = ownedList.includes(t.id);
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <div class="preview-box" style="background:${t.color}"></div>
          <h3>${t.name}</h3>
          <button class="buy-btn" data-id="${t.id}" ${isOwned ? 'disabled' : ''}>
            ${isOwned ? 'Claimed' : 'FREE'}
          </button>
        `;

        div.addEventListener('mouseenter', () => {
          bgLayer.style.backgroundImage = `url('${t.bg}')`;
          bgLayer.style.opacity = "0.6";
          document.body.style.backgroundColor = t.color;
        });

        div.addEventListener('mouseleave', () => {
          bgLayer.style.opacity = "0.3";
          document.body.style.backgroundColor = "#0b0e11";
        });

        grid.appendChild(div);
      });
    }

    // Check for Extension Storage
    if (typeof chrome !== "undefined" && chrome.storage) {
      chrome.storage.local.get(['ownedThemes'], (data) => {
        renderStore(data.ownedThemes || ['cyberpunk']);
      });
    } else {
      // If viewing on Netlify directly, just show all themes as available
      renderStore(['cyberpunk']);
      console.log("Running in Web Mode: Storage Unavailable");
    }

    // Handle Claims
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('buy-btn')) {
        const id = e.target.dataset.id;
        
        if (typeof chrome !== "undefined" && chrome.storage) {
          chrome.storage.local.get(['ownedThemes'], (data) => {
            const owned = data.ownedThemes || ['cyberpunk'];
            if (!owned.includes(id)) {
              owned.push(id);
              chrome.storage.local.set({ownedThemes: owned}, () => {
                e.target.innerText = "Claimed";
                e.target.disabled = true;
              });
            }
          });
        } else {
          alert("Install the extension to 'buy' this theme!");
        }
      }
    });
  </script>
</body>
</html>
